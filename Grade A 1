1.1 What Photometric Stereo REALLY Is (No Math Yet)
Photometric stereo means:
Same camera position, same object position, different light directions
From how brightness changes when light direction changes, we infer:
Surface orientation
Micro-slopes
Height variations (dents)
âš ï¸ Camera never moves
âš ï¸ Object never moves
âš ï¸ ONLY light changes
Thatâ€™s why your black box + fixed geometry is mandatory.
1.2 How Your Lighting Setup Fits PERFECTLY
You already have:
Blue raking light (LEFT)
Warm raking light (RIGHT)
Optional back or front raking (add later)
Top white (NOT used for stereo)
Capture Plan (MINIMUM)
You need at least 3 lights for full 3D normals, but 2 lights are enough for dent detection.
Recommended capture set:
Image
Light ON
Light Direction
Iâ‚
Blue only
Left â†’ Right
Iâ‚‚
Warm only
Right â†’ Left
Iâ‚ƒ (optional)
Front low
Bottom â†’ Top
1.3 Geometry (IMPORTANT)
Letâ€™s define axes:
Z â†’ Camera direction (up)
X â†’ Leftâ€“Right
Y â†’ Bottomâ€“Top
Each light has a known direction vector:
Example:
Blue light at 25Â° from surface:
Copy code

Lâ‚ = (cos25Â°, 0, sin25Â°)
Warm light at 15Â°:
Copy code

Lâ‚‚ = (-cos15Â°, 0, sin15Â°)
ğŸ“Œ You donâ€™t need exact perfection â€” approximate angles are enough.
1.4 What the Camera Sees
At each pixel:
Flat surface â†’ similar brightness in all images
Dent â†’ brightness changes drastically
Scratch â†’ specular spike in one image
Photometric stereo turns brightness change into geometry.
2ï¸âƒ£ Mathematical Extraction of DENTS from SHADOWS
Now the math â€” but Iâ€™ll keep it intuitive and usable.
2.1 Image Formation Model (Simplified)
For each pixel:
Copy code

I = Ï Â· (L Â· N)
Where:
I = pixel intensity
Ï (rho) = surface reflectance (assumed constant locally)
L = light direction vector
N = surface normal vector
2.2 With Multiple Lights
You capture:
Copy code

Iâ‚ = Ï Â· (Lâ‚ Â· N)
Iâ‚‚ = Ï Â· (Lâ‚‚ Â· N)
Iâ‚ƒ = Ï Â· (Lâ‚ƒ Â· N)
Matrix form:
Copy code

[Iâ‚]   [Lâ‚x Lâ‚y Lâ‚z]   [ÏNx]
[Iâ‚‚] = [Lâ‚‚x Lâ‚‚y Lâ‚‚z] Â· [ÏNy]
[Iâ‚ƒ]   [Lâ‚ƒx Lâ‚ƒy Lâ‚ƒz]   [ÏNz]
Solve for N using least squares.
2.3 What a DENT Does Mathematically
A dent:
Changes surface normal
Causes local slope
Alters dot product with light
So:
One side of dent gets brighter
Opposite side gets darker
This asymmetry is your dent signal.
2.4 Converting Normals â†’ Height (Depth)
Normals give you:
Copy code

Nx = âˆ‚Z/âˆ‚X
Ny = âˆ‚Z/âˆ‚Y
So depth Z(x,y) is recovered by integration:
Copy code

Z(x,y) = âˆ¬ (Nx, Ny)
In practice:
Use Poisson integration
Or simple cumulative sum for dents
ğŸ“Œ You donâ€™t need full 3D â€” dent detection works with slope maps alone.
2.5 Ultra-Simple Dent Detection (No Full Stereo)
If you want a minimal solution:
Copy code

DENT_MAP = |I_left - I_right|
Why this works:
Flat area â†’ similar brightness
Dent â†’ one side bright, other dark
This is shockingly effective for sub-mm dents.
3ï¸âƒ£ How Many PIXELS Do You Need for 0.1 mm?
This is where most people get confused.
3.1 The BIG TRUTH
You do NOT need:
â€œOne pixel per defect sizeâ€
You need:
Multiple pixels across the SHADOW GRADIENT
3.2 Practical Rule (Industry)
To reliably detect a feature of size d:
Copy code

Pixel size â‰¤ d / 5
So for:
d = 0.1 mm
Required pixel size â‰ˆ 0.02 mm (20 microns)
3.3 What This Means for Camera Resolution
Example:
Phone width â‰ˆ 70 mm
Required resolution across width:
Copy code

70 mm / 0.02 mm = 3500 pixels
So:
4K width (3840 px) is enough
12 MP camera is sufficient IF:
You zoom / crop
You donâ€™t capture full phone at once
ğŸ“Œ Industry NEVER captures full object in one shot for micro defects.
3.4 Sensor + Lens Reality Check
Resolution depends on:
Sensor pixel size
Lens sharpness
Working distance
Example:
IMX477 (1.55 Âµm pixel)
Macro lens
FOV = 50 mm
Effective resolution:
Copy code

50 mm / 4000 px â‰ˆ 0.0125 mm per pixel
Thatâ€™s enough for 0.1 mm dents.
3.5 Lighting vs Resolution (IMPORTANT)
Bad lighting + 50 MP = âŒ FAIL
Good lighting + 8 MP = âœ… SUCCESS
Because:
Lighting creates contrast
Camera only samples contrast
HOW ALL 3 CONNECT (THIS IS KEY)
Component
Role
Photometric stereo
Converts light variation â†’ geometry
Shadow math
Converts brightness â†’ slope
Pixel density
Samples slope accurately
If any one fails, system fails.
FINAL INDUSTRY-LEVEL SUMMARY
Sub-millimeter defect detection is not a resolution problem â€” it is a controlled-light, slope-amplification problem solved using photometric stereo.
What I recommend next (logical order):
1ï¸âƒ£ Exact numeric example (with real pixel values)
2ï¸âƒ£ OpenCV code for left-right shadow dent map
3ï¸âƒ£ How CNNs consume photometric stereo outputs
4ï¸âƒ£ Tolerance limits: smallest dent you can detect
Tell me which one you want â€” weâ€™ll go even deeper.
